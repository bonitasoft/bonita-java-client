:doctype: book
:sectnums:
:icons: font
:source-highlighter: highlightjs
:idprefix:
:idseparator: -
:sectlinks:
:sectanchors:
:linkcss: false
:allow-uri-read:
:imagesdir: ./doc/images

:bonita-short-version: 7.11
:project-group-id: org.bonitasoft.web
:project-artifact-id: bonita-java-client
:project-version: 1.0.0-SNAPSHOT

[.float-group]
--
[.left]
image::Bonitasoft_Community_RGB.png[Bonitasoft,link="https://www.bonitasoft.com",width=450px,float=left]
[.left]
image::openapi.png[OpenAPI,link="https://swagger.io/specification",width=150px,float=left]
--

[.float-group]
--
[.left]
image::https://github.com/bonitasoft/{project-artifact-id}/workflows/Build/badge.svg[Build Status,link="https://github.com/bonitasoft/{project-artifact-id}/actions?query=workflow%3ABuild",float=left]
[.left]
image::https://img.shields.io/github/v/release/bonitasoft/{project-artifact-id}?color=blue&label=Release[Release,link="https://github.com/bonitasoft/{project-artifact-id}/releases",float=left]
[.left]
image::https://img.shields.io/maven-central/v/{project-group-id}/{project-artifact-id}.svg?label=Maven%20Central&color=orange[Maven Central,link="https://search.maven.org/search?q=g:%22{project-group-id}%22%20AND%20a:%22{project-artifact-id}%22",float=left]
[.left]
image::https://img.shields.io/badge/License-GPL%20v2-yellow.svg[License,link="https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html",float=left]
--

= Bonita Java Client

This project is the official web client for Bonita when working with Java (or on the JVM).

It is based on an https://swagger.io/specification/[OpenAPI] specification for **Bonita {bonita-short-version}** `enterprise` edition.
This means that this client includes all community operations plus some that are only supported by `enterprise` editions servers.

//_**TODO**_: A brief description of your project, what it is used for and how does life get awesome when someone starts to use it.

== Features

//_**TODO**_: What's all the bells and whistles this project can perform?

* Cover publicly available http endpoints of Bonita Platform {bonita-short-version} and onwards
* Built-in Bonita authentication support (SSO not supported yet)
* Higher level code than raw openapi client to ease developer journey

== Getting started

//_**TODO**_: A quick introduction of the minimal setup you need to get a hello world up & running.

After the client library is installed/deployed, you can use it in your Maven project by adding the following to your *pom.xml*:

[source,xml,subs="attributes+"]
----
<dependency>
    <groupId>{project-group-id}</groupId>
    <artifactId>{project-artifact-id}</artifactId>
    <version>{project-version}</version>
</dependency>
----

The following code creates a java client instance targeting a bonita server listening at `http://localhost:8080/bonita`. After login in, it queries the deployed processes
with pagination parameters (page index: 0,page size: 20)

[source,java,subs="attributes"]
----
// Create a client
BonitaCLient client = BonitaCLient.builder("http://localhost:8080/bonita").build();

// Login
Session session = client.login("username","password");
// Log Bonita server version
log.debug("Bonita version: {}", session.getVersion());

// Use the client &#x1F973;
List<BusinessProcess> businessProcesses = client.processes().searchProcesses(0, 20);

// Logout when done
client.logout();
----

== Configuration

=== Logging

Different log level are available. Default level is `OFF`

- `FULL`: Headers + Body
- `HEADER`: Headers
- `BASIC`: HTTP trace (url + verb + response code)
- `OFF`: No log

[source, java]
----
BonitaClient client = BonitaClient.builder("http://localhost:8080/bonita")
        .logContentLevel(LogContentLevel.BASIC)
    .build();
----

The logger name is `org.bonitasoft.web.client.BonitaClient` and logging is done with to slf4j so if you're using logback implementation, you may configure your logger like this :

[source, xml]
----
<logger name="org.bonitasoft.web.client.BonitaClient" level="INFO"/>
----


=== http timeouts

The following code show how you can customize the client http timeouts.

[source, java]
----
BonitaClient client = BonitaClient.builder("http://localhost:8080/bonita")
        .connectTimeoutInSeconds(int connectTimeoutInSeconds)
        .readTimeoutInSeconds(int readTimeoutInSeconds)
        .writeTimeoutInSeconds(int writeTimeoutInSeconds)
    .build();
----

=== SSL

If you need for any reason to disable ssl certificate check, here is the code to do it:

[source, java]
----
BonitaClient client = BonitaClient.builder("http://localhost:8080/bonita")
        // Disable certificate check
        .disableCertificateCheck(true)
    .build();
----

WARNING: Please note that this is not recommended from a security point of vue !

=== Custom Jackson object mapper

[source, java]
----
// Create your custom ObjectMapper
ObjectMapper myObjectMapper = = new ObjectMapper();

// Configure bonita client to use your custom ObjectMapper
BonitaClient client = BonitaClient.builder("http://localhost:8080/bonita")
        .objectMapper(myObjectMapper)
    .build();
----


=== Custom OkHttp Client

[source, java]
----
// Create your custom OkHttp client
OkHttpClient myOkHttpClient = new OkHttpClient.Builder().build();

// Configure bonita client to use your custom OkHttp client
BonitaClient client = BonitaClient.builder("http://localhost:8080/bonita")
        okHttpClient(myOkHttpClient)
    .build();
----

=== Custom Feign configuration

The current implementation of the client use OpenFeign internally. If you need to fine tune the feign aspect, it is possible but remember this may change in future version.

[source, java]
----
// Create your custom feign builder
Feign.Builder myFeignBuilder = new Feign.Builder();

BonitaClientBuilder builder = BonitaClient.builder("http://localhost:8080/bonita");
// Cast builder to BonitaFeignClientBuilder class
BonitaFeignClientBuilder bonitaClientBuilder = (BonitaFeignClientBuilder) builder;
BonitaClient client = bonitaClientBuilder
        // Configure bonita client to use your custom feign builder
        .feignBuilder(myFeignBuilder)
    .build();
----

== Developing

=== Prerequisite

- a git client
- a java (jdk8 or higher)
- maven (optional if you chose to use https://github.com/takari/maven-wrapper[maven wrapper script])

=== Building

This is a standard maven project. To install the java client library to your local Maven repository, simply execute:

[source,bash]
----
git clone https://github.com/bonitasoft/bonita-java-client.git
cd bonita-java-client/
mvn install
----

The build should produce under the `target/` folder (and in your local maven repository) a jar archive named `bonita-java-client-1.0.0-SNAPSHOT.jar`

For more details about apache maven, please refer to the https://maven.apache.org/guides/getting-started/[documentation]

=== Branches

The adopted worlfow is for now the Gitflow one.

Please refers to this article for more info: https://jeffkreeftmeijer.com/git-flow/

== Links

- Project homepage: https://github.com/bonitasoft/{project-artifact-id}/
- Repository: https://github.com/bonitasoft/{project-artifact-id}/
- Issue tracker: https://github.com/bonitasoft/{project-artifact-id}/issues. +
  In case of sensitive bugs like security vulnerabilities, please contact rd@bonitasoft.com directly instead of using issue tracker. We value your effort to improve the security and privacy of this project!
- Current Bonita REST API documentation: https://documentation.bonitasoft.com/bonita/{bonita-short-version}/rest-api-overview
- OpenAPI specification: https://swagger.io/specification/
- OpenAPI generator: https://github.com/OpenAPITools/openapi-generator
- OpenFeign: https://github.com/OpenFeign/feign
- slf4j: http://www.slf4j.org/
- Jackson ObjectMapper: https://github.com/FasterXML/jackson-databind